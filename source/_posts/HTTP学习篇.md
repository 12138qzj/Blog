---
title: HTTP学习篇
top: false
cover: false
toc: true
mathjax: true
date: 2020-08-1 13:23:23
password:
summary:
tags:
- 浏览器
- HTTP
categories:
---

## TCP/IP协议族分层

 tcp/ip协议族分为四层：**应用层，传输层，网络层，数据链路层**

<img src="四层.png" alt="2" style="zoom:60%;" />

计算机与网络设备要相互通信，双方就必须基于相同的方法。比如，如何探测到通信目标、由哪一边先发起通信、使用哪种语言进行通信、怎样结束通信等规则都需要事先确定。不同的硬件、操作系统之间的通信，所有的这一切都需要一种规则。而我们就把这种规则称为协议



TCP/IP协议族各层的作用如下。

### 应用层

应用层决定了向用户提供应用服务时通信的活动。TCP/IP协议族内预存了各类通用的应用服务。比如，FTP（File Transfer Protocol，文件传输协议）和DNS（Domain Name System，域名系统）服务就是其中两类。HTTP协议也处于该层。

### 传输层

传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输。在传输层有两个性质不同的协议：**TCP（Transmission Control Protocol，传输控制协议）和UDP（User Data Protocol，用户数据报协议）**。

### 网络层（又名网络互连层）

**网络层用来处理在网络上流动的数据包**。数据包是网络传输的最小数据单位。该层规定了通过怎样的路径（所谓的传输路线）到达对方计算机，并把数据包传送给对方。与对方计算机之间通过多台计算机或网络设备进行传输时，**网络层所起的作用就是在众多的选项内选择一条传输路线。**

### 链路层（又名数据链路层，网络接口层）

**用来处理连接网络的硬件部分**。包括控制操作系统、硬件的设备驱动、NIC（NetworkInterface Card，网络适配器，即网卡），及光纤等物理可见部分（还包括连接器等一切传输媒介）。**硬件上的范畴均在链路层的作用范围之内**。

## http数据传输的过程客户端-服务端





![数据封装](http请求过程.png)



**浏览器输入地址=>在本地DNS服务器上查找域名ip=>返回给浏览器ip的情况=>然后通过TCP/IP（三次握手）连接服务器=>然后数据传输=>四次挥手断开连接**

完成一次http的访问。

### DNS服务（使用DNS协议）

​		DNS服务应运而生。DNS协议提供通过域名查找IP地址，或逆向从IP地址反查域名的服务。

![image-20200517211619609](image-20200517211619609.png)

### DNS域名解析完之后-数据打包

![数据封装](数据封装.png)

### HTTP数据传输过程



 为了传输方便，在传输层（TCP协议）把从应用层处收到的数据（HTTP请求报文）进行分割，并在各个报文上打上标记序号及端口号后转发给网络层。



![image-20200517191757183](image-20200517191757183.png)

![http数据传输过程](http数据传输过程.png)

**ARP**是一种用以解析地址的协议，根据通信方的IP地址就可以反查出对应的MAC地址。

### 网关-代理服务器

#### 1.网关

​		**作用：**网关的工作机制和代理十分相似。而网关能使通信线路上的服务器提供非HTTP协议服务。

​		利用网关能提高通信的安全性，因为可以在客户端与网关之间的通信线路上加密以确保连接的安全。比如，网关可以连接数据库，使用SQL语句查询数据。另外，在Web购物网站上进行信用卡结算时，网关可以和信用卡结算系统联动。



![image-20200517215504244](image-20200517215504244.png)

#### 2.代理服务器

​		**作用：**代理服务器的基本行为就是接收客户端发送的请求后转发给其他服务器。代理不改变请求URI，会直接发送给前方持有资源的目标服务器。

![image-20200517215617647](image-20200517215617647.png)

#### 3.隧道

​			**作用：**隧道可按要求建立起一条与其他服务器的通信线路，届时使用SSL等加密手段进行通信。隧道的目的是确保客户端能与服务器进行安全的通信。隧道本身不会去解析HTTP请求。也就是说，请求保持原样中转给之后的服务器。隧道会在通信双方断开连接时结束。

![image-20200517215911886](image-20200517215911886.png)

## HTTP/1.1 首部字段一览(47个首部--通用，请求，响应，实体）

### 通用头部

![image-20200518090100570](image-20200518090100570.png)

### 请求头部

![image-20200518090221053](image-20200518090221053.png)

### 响应头部

![image-20200518090240543](image-20200518090240543.png)

### 实体头部

![image-20200518090256405](image-20200518090256405.png)

## HTTP缓存机制

### （1）Expires缓存



![image-20200518093115611](image-20200518093115611.png)

### （2）Last-Modified-------if-modified-since缓存



**第一次访问**设置**Last-Modified**

res.setHeader('Last-Modified', status.mtime);设置最后访问时间

**第二次访问**的时候就会在请求头中加入**if-modified-since**该时间为第一次访问时**Last-Modified**的时间

if (req.headers['if-modified-since'] == status.mtime) 

#### ---缺点

​	**当在同一秒访问的时候，时间将不会改变，则无法检测文件是否改变**

![image-20200518093204257](image-20200518093204257.png)

### （3）Etag---if-none-match(版本号)缓存机制



第一次访问的时候设置版本号，响应头里面存在 ``` Etag：version ```

再次访问的时候，浏览器将``` Etag：version ```加到请求头里面为：``` if-none-match：version ```

```javascript
 res.setHeader('Etag', version);//设置版本号
if (Number(req.headers['if-none-match'] == version)) //判断版本号  
```

### （4)md5/hash缓存

​	通过不缓存html,为静态文件添加MD5或者hash标识，解决浏览器无法跳过缓存过期时间主动感知文件变化的问题

###    (5)CDN缓存

​	CDN是构建在网络之上的内容分发网络，依靠部署哎各地的边缘服务器，通过中心平台的负载均衡，内容分发，调度等功能模块，使用户就近获取所需内容，减低网络拥塞，提高用户访问响应速度和命中率。

​	如同代理一样，设置缓存过期时间，

![image-20200518094603537](image-20200518094603537.png)

